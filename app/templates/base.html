<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Taskly</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/taskly.css">
</head>
<body class="bg-light">
  <header class="bg-primary text-white py-3 mb-4 shadow">
    <div class="container d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0">Taskly</h1>
      <small>Distributed Team Task Management</small>
    </div>
  </header>

  <main class="container mb-5">
    <div id="refresh-banner" class="alert alert-warning d-none" role="alert">
  ⚠️ New task updates detected. <a href="" class="alert-link">Click to refresh</a>
    </div>

    {% block content %}{% endblock %}
  </main>

  <footer class="bg-dark text-light text-center py-3 mt-auto">
    <div class="container">
      <small>&copy;2025 Taskly</small>
    </div>
  </footer>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const banner = document.getElementById('refresh-banner');
  const refreshLink = banner?.querySelector('a');

  // User clicks the refresh link = they acknowledge the update
  refreshLink?.addEventListener("click", () => {
    const latest = localStorage.getItem("latestOverdueUpdate");
    if (latest) {
      localStorage.setItem("lastSeenOverdueUpdate", latest);
    }
  });

  setInterval(async () => {
    try {
      const res = await fetch('/api/check-updates');
      const data = await res.json();

      console.log("Check result:", data);

      if (data.updated && data.latest_update) {
        localStorage.setItem("latestOverdueUpdate", data.latest_update);

        const seen = localStorage.getItem("lastSeenOverdueUpdate");
        const latest = data.latest_update;

        if (latest !== seen) {
          banner.classList.remove('d-none');
          console.log("✅ Banner shown for new overdue task");
        } else {
          console.log("✅ Overdue known, already seen");
        }
      } else {
        console.log("✅ No overdue tasks found");
      }
    } catch (e) {
      console.error("❌ Update check failed:", e);
    }
  }, 30000);
});
</script>


</body>
</html>
